language: cpp
matrix:
  allow_failures:
    - os: osx
  include:
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources: ['ubuntu-toolchain-r-test']
          packages: ['g++-4.7']
      env:
        - COMPILER=g++-4.7

    - os: linux
      compiler: gcc
      addons:
        apt:
          sources: ['ubuntu-toolchain-r-test']
          packages: ['g++-4.8']
      env:
        - COMPILER=g++-4.8

    - os: linux
      compiler: gcc
      addons:
        apt:
          sources: ['ubuntu-toolchain-r-test']
          packages: ['g++-4.9']
      env:
        - COMPILER=g++-4.9

    - os: linux
      compiler: gcc
      addons:
        apt:
          sources: ['ubuntu-toolchain-r-test']
          packages: ['g++-5']
      env:
        - COMPILER=g++-5

    - os: linux
      compiler: gcc
      addons:
        apt:
          sources: ['ubuntu-toolchain-r-test']
          packages: ['g++-6']
      env:
        - COMPILER=g++-6

## clang's support for OpenMP requires extra work
## just skip it for now
#    - os: linux
#      compiler: clang
#      env:
#        - COMPILER=clang++
#
#    - os: linux
#      compiler: clang
#      addons:
#        apt:
#          sources: ['ubuntu-toolchain-r-test', 'llvm-toolchain-precise-3.5']
#          packages: ['clang-3.5']
#      env:
#        - COMPILER=clang++-3.5
#
#    - os: linux
#      compiler: clang
#      addons:
#        apt:
#          sources: ['ubuntu-toolchain-r-test', 'llvm-toolchain-precise-3.6']
#          packages: ['clang-3.6']
#      env:
#        - COMPILER=clang++-3.6
#
#    - os: linux
#      compiler: clang
#      addons:
#        apt:
#          sources: ['ubuntu-toolchain-r-test', 'llvm-toolchain-precise-3.7']
#          packages: ['clang-3.7']
#      env:
#        - COMPILER=clang++-3.7
#
#    - os: linux
#      compiler: clang
#      addons:
#        apt:
#          sources: ['ubuntu-toolchain-r-test', 'llvm-toolchain-precise-3.8']
#          packages: ['clang-3.8']
#      env:
#        - COMPILER=clang++-3.8
#
##    - os: linux
##      compiler: clang
##      addons:
##        apt:
##          sources: ['ubuntu-toolchain-r-test', 'llvm-toolchain-precise-3.9']
##          packages: ['clang-3.9']
##      env:
##        - COMPILER=clang++-3.9
# 
#     - os: osx
#       osx_image: xcode6.4
#       compiler: clang
#       env:
#         - COMPILER=clang++
# 
#     - os: osx
#       osx_image: xcode7.3
#       compiler: clang
#       env:
#         - COMPILER=clang++
# 
#     - os: osx
#       osx_image: xcode8.2
#       compiler: clang
#       env:
#         - COMPILER=clang++

## For simplicity, do not need to compile for xcode9, xcode10
    # - os: osx
    #   osx_image: xcode10
    #   compiler: g++
    #   env:
    #     - COMPILER=g++
    # - os: osx
    #   osx_image: xcode9
    #   compiler: g++
    #   env:
    #     - COMPILER=g++
    - os: osx
      osx_image: xcode8
      compiler: g++
      env:
        - COMPILER=g++
        - MATRIX_EVAL="CC=gcc-4.9 && CXX=g++-4.9"
    - os: osx
      osx_image: xcode8
      compiler: g++
      env:
        - COMPILER=g++
        - MATRIX_EVAL="brew install gcc && CC=gcc-7 && CXX=g++-7"

before_install:
  - uname -a
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then free -m; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then vm_stat; fi
  - df -h
  - ulimit -a
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get update -q && sudo apt-get install -y -qq gfortran; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then eval "${MATRIX_EVAL}"; fi

script: make CXX=$COMPILER
